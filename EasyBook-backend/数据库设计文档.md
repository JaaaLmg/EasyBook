## 5. 表结构设计

### 5.1 核心表设计

#### 5.1.1 图书表 (books)

| 字段名            | 数据类型 | 长度 | 是否为空 | 默认值            | 说明         | 约束                                                                 |
| ----------------- | -------- | ---- | -------- | ----------------- | :----------- | -------------------------------------------------------------------- |
| isbn              | VARCHAR  | 20   | NOT NULL |                   | 国际标准书号 | 主键                                                                 |
| title             | VARCHAR  | 200  | NOT NULL |                   | 书名         |                                                                      |
| edition           | VARCHAR  | 10   |          |                   | 版次         |                                                                      |
| publisher_id      | VARCHAR  | 10   | NOT NULL |                   | 出版社ID     | 外键                                                                 |
| publish_date      | DATE     |      |          |                   | 出版日期     |                                                                      |
| price             | DECIMAL  | 10,2 | NOT NULL | 0.00              | 售价         | CHECK(price>=0)                                                      |
| page_count        | INT      |      |          | 0                 | 页数         |                                                                      |
| format            | VARCHAR  | 20   |          |                   | 开本         |                                                                      |
| language          | VARCHAR  | 10   | NOT NULL | 'zh'              | 语言         |                                                                      |
| description       | TEXT     |      |          |                   | 简介         |                                                                      |
| table_of_contents | TEXT     |      |          |                   | 目录         |                                                                      |
| cover_image       | VARCHAR  | 200  |          |                   | 封面图片路径 |                                                                      |
| series_id         | VARCHAR  | 10   |          |                   | 丛书ID       | 外键                                                                 |
| book_type         | VARCHAR  | 10   | NOT NULL | 'normal'          | 图书类型     | CHECK(book_type IN ('normal','ebook','audio'))                       |
| status            | VARCHAR  | 10   | NOT NULL | 'active'          | 状态         | CHECK(status IN ('active','inactive','out_of_print','out_of_stock')) |
| create_time       | DATETIME |      | NOT NULL | CURRENT_TIMESTAMP | 创建时间     |                                                                      |
| update_time       | DATETIME |      | NOT NULL | CURRENT_TIMESTAMP | 更新时间     |                                                                      |

#### 5.1.2 出版社表 (publishers)

| 字段名         | 数据类型 | 长度 | 是否为空 | 默认值            | 说明       | 约束     |
| -------------- | -------- | ---- | -------- | ----------------- | ---------- | -------- |
| publisher_id   | VARCHAR  | 10   | NOT NULL |                   | 出版社ID   | 主键     |
| publisher_name | VARCHAR  | 100  | NOT NULL |                   | 出版社名称 | 唯一索引 |
| address        | VARCHAR  | 200  |          |                   | 地址       |          |
| contact_phone  | VARCHAR  | 20   |          |                   | 联系电话   |          |
| contact_person | VARCHAR  | 50   |          |                   | 联系人     |          |
| email          | VARCHAR  | 100  |          |                   | 邮箱       |          |
| website        | VARCHAR  | 100  |          |                   | 网站       |          |
| description    | TEXT     |      |          |                   | 简介       |          |
| create_time    | DATETIME |      | NOT NULL | CURRENT_TIMESTAMP | 创建时间   |          |
| update_time    | DATETIME |      | NOT NULL | CURRENT_TIMESTAMP | 更新时间   |          |

#### 5.1.3 作者表 (authors)

| 字段名      | 数据类型 | 长度 | 是否为空 | 默认值            | 说明     | 约束 |
| ----------- | -------- | ---- | -------- | ----------------- | -------- | ---- |
| author_id   | VARCHAR  | 10   | NOT NULL |                   | 作者ID   | 主键 |
| author_name | VARCHAR  | 50   | NOT NULL |                   | 作者姓名 |      |
| nationality | VARCHAR  | 20   |          |                   | 国籍     |      |
| birth_date  | DATE     |      |          |                   | 出生日期 |      |
| biography   | TEXT     |      |          |                   | 作者简介 |      |
| create_time | DATETIME |      | NOT NULL | CURRENT_TIMESTAMP | 创建时间 |      |

#### 5.1.4 图书作者表 (book_authors)

| 字段名       | 数据类型 | 长度 | 是否为空 | 默认值   | 说明     | 约束                                                            |
| ------------ | -------- | ---- | -------- | -------- | -------- | --------------------------------------------------------------- |
| isbn         | VARCHAR  | 20   | NOT NULL |          | 图书ISBN | 外键,复合主键                                                   |
| author_id    | VARCHAR  | 10   | NOT NULL |          | 作者ID   | 外键,复合主键                                                   |
| author_order | TINYINT  |      | NOT NULL | 1        | 作者顺序 | CHECK(author_order BETWEEN 1 AND 4), UNIQUE(isbn, author_order) |
| author_type  | VARCHAR  | 10   | NOT NULL | 'author' | 作者类型 | CHECK(author_type IN ('author','translator','editor'))          |

**约束说明**：

- `UNIQUE(isbn, author_order)`：确保同一本书的作者顺序不能重复（如不能有两个第一作者）

#### 5.1.5 客户表 (customers)

| 字段名            | 数据类型 | 长度 | 是否为空 | 默认值            | 说明         | 约束                                                                          |
| ----------------- | -------- | ---- | -------- | ----------------- | ------------ | ----------------------------------------------------------------------------- |
| customer_id       | VARCHAR  | 10   | NOT NULL |                   | 客户ID       | 主键                                                                          |
| username          | VARCHAR  | 50   | NOT NULL |                   | 用户名       | 唯一索引                                                                      |
| password_hash     | VARCHAR  | 100  | NOT NULL |                   | 密码哈希值   |                                                                               |
| real_name         | VARCHAR  | 50   | NOT NULL |                   | 真实姓名     |                                                                               |
| email             | VARCHAR  | 100  | NOT NULL |                   | 邮箱         | 唯一索引                                                                      |
| phone             | VARCHAR  | 20   |          |                   | 电话         |                                                                               |
| address           | VARCHAR  | 200  |          |                   | 地址         |                                                                               |
| account_balance   | DECIMAL  | 10,2 | NOT NULL | 0.00              | 账户余额     |                                                                               |
| credit_level      | INT      |      | NOT NULL | 1                 | 信用等级     | CHECK(credit_level BETWEEN 1 AND 5)（建议：外键关联 `credit_rules(level)`） |
| total_purchase    | DECIMAL  | 12,2 | NOT NULL | 0.00              | 累计消费金额 |                                                                               |
| registration_date | DATETIME |      | NOT NULL | CURRENT_TIMESTAMP | 注册日期     |                                                                               |
| last_login        | DATETIME |      |          |                   | 最后登录时间 |                                                                               |
| account_status    | VARCHAR  | 10   | NOT NULL | 'active'          | 账户状态     | CHECK(account_status IN ('active','frozen','closed'))                         |

#### 5.1.6 订单表 (orders)

| 字段名           | 数据类型 | 长度 | 是否为空 | 默认值            | 说明         | 约束                                                                                                |
| ---------------- | -------- | ---- | -------- | ----------------- | :----------- | --------------------------------------------------------------------------------------------------- |
| order_id         | VARCHAR  | 20   | NOT NULL |                   | 订单ID       | 主键                                                                                                |
| order_no         | VARCHAR  | 30   | NOT NULL |                   | 订单号       | 唯一索引                                                                                            |
| customer_id      | VARCHAR  | 10   | NOT NULL |                   | 客户ID       | 外键                                                                                                |
| total_amount     | DECIMAL  | 12,2 | NOT NULL | 0.00              | 商品原价合计 | 说明：明细原价累计（`unit_price * quantity`），不含折扣                                           |
| discount_amount  | DECIMAL  | 10,2 | NOT NULL | 0.00              | 折扣金额合计 | 说明：折扣让利金额累计（原价 * 折扣率），不含运费                                                   |
| actual_amount    | DECIMAL  | 12,2 | NOT NULL | 0.00              | 应付金额合计 | 说明：折后应付累计（原价合计 - 折扣额），本设计用于发货扣款金额（方案A：发货时扣款）                |
| shipping_fee     | DECIMAL  | 8,2  | NOT NULL | 0.00              | 运费         |                                                                                                     |
| order_status     | VARCHAR  | 20   | NOT NULL | 'pending'         | 订单状态     | CHECK(order_status IN ('pending','paid','processing','shipped','delivered','cancelled','refunded')) |
| shipping_address | VARCHAR  | 200  | NOT NULL |                   | 收货地址     |                                                                                                     |
| recipient_name   | VARCHAR  | 50   | NOT NULL |                   | 收货人姓名   |                                                                                                     |
| recipient_phone  | VARCHAR  | 20   | NOT NULL |                   | 收货人电话   |                                                                                                     |
| payment_method   | VARCHAR  | 20   |          |                   | 支付方式     |                                                                                                     |
| payment_time     | DATETIME |      |          |                   | 支付时间     |                                                                                                     |
| order_time       | DATETIME |      | NOT NULL | CURRENT_TIMESTAMP | 下单时间     |                                                                                                     |
| shipping_time    | DATETIME |      |          |                   | 发货时间     |                                                                                                     |
| delivery_time    | DATETIME |      |          |                   | 送达时间     |                                                                                                     |
| notes            | TEXT     |      |          |                   | 订单备注     |                                                                                                     |

> **说明（与方案A一致）**：
>
> - `paid` 表示支付已确认（或信用允许先发后付），此时仅记录 `payment_time`，不扣减余额。
> - `sp_process_delivery` 发货时以 `actual_amount` 作为扣款金额，从客户余额中扣除；扣款成功后订单置为 `shipped`。

#### 5.1.7 订单明细表 (order_details)

| 字段名        | 数据类型 | 长度 | 是否为空 | 默认值 | 说明     | 约束                                 |
| ------------- | -------- | ---- | -------- | ------ | -------- | ------------------------------------ |
| detail_id     | VARCHAR  | 20   | NOT NULL |        | 明细ID   | 主键                                 |
| order_id      | VARCHAR  | 20   | NOT NULL |        | 订单ID   | 外键                                 |
| isbn          | VARCHAR  | 20   | NOT NULL |        | 图书ISBN | 外键                                 |
| quantity      | INT      |      | NOT NULL | 1      | 数量     | CHECK(quantity > 0)                  |
| unit_price    | DECIMAL  | 10,2 | NOT NULL |        | 单价     |                                      |
| discount_rate | DECIMAL  | 5,4  | NOT NULL | 0.0000 | 折扣率   | CHECK(discount_rate BETWEEN 0 AND 1) |
| subtotal      | DECIMAL  | 10,2 | NOT NULL |        | 小计     |                                      |

#### 5.1.8 库存表 (inventory)

| 字段名            | 数据类型 | 长度 | 是否为空 | 默认值            | 说明         | 约束                          |
| ----------------- | -------- | ---- | -------- | ----------------- | ------------ | ----------------------------- |
| inventory_id      | VARCHAR  | 20   | NOT NULL |                   | 库存ID       | 主键                          |
| isbn              | VARCHAR  | 20   | NOT NULL |                   | 图书ISBN     | 外键,唯一索引                 |
| quantity          | INT      |      | NOT NULL | 0                 | 当前数量     | CHECK(quantity >= 0)          |
| safety_stock      | INT      |      | NOT NULL | 10                | 安全库存     | CHECK(safety_stock >= 0)      |
| reserved_quantity | INT      |      | NOT NULL | 0                 | 预留数量     | CHECK(reserved_quantity >= 0) |
| location_code     | VARCHAR  | 20   |          |                   | 存放位置编码 |                               |
| warehouse         | VARCHAR  | 20   | NOT NULL | 'main'            | 仓库         |                               |
| last_restock      | DATETIME |      |          |                   | 最后补货时间 |                               |
| last_check        | DATETIME |      | NOT NULL | CURRENT_TIMESTAMP | 最后盘点时间 |                               |

#### 5.1.9 供应商表 (suppliers)

| 字段名             | 数据类型 | 长度 | 是否为空 | 默认值            | 说明       | 约束                                                             |
| ------------------ | -------- | ---- | -------- | ----------------- | ---------- | ---------------------------------------------------------------- |
| supplier_id        | VARCHAR  | 10   | NOT NULL |                   | 供应商ID   | 主键                                                             |
| supplier_name      | VARCHAR  | 100  | NOT NULL |                   | 供应商名称 |                                                                  |
| contact_person     | VARCHAR  | 50   | NOT NULL |                   | 联系人     |                                                                  |
| contact_phone      | VARCHAR  | 20   | NOT NULL |                   | 联系电话   |                                                                  |
| email              | VARCHAR  | 100  | NOT NULL |                   | 邮箱       |                                                                  |
| address            | VARCHAR  | 200  | NOT NULL |                   | 地址       |                                                                  |
| bank_account       | VARCHAR  | 50   |          |                   | 银行账户   |                                                                  |
| tax_number         | VARCHAR  | 30   |          |                   | 税号       |                                                                  |
| cooperation_status | VARCHAR  | 10   | NOT NULL | 'active'          | 合作状态   | CHECK(cooperation_status IN ('active','suspended','terminated')) |
| rating             | DECIMAL  | 3,2  |          | 5.00              | 评分       | CHECK(rating BETWEEN 0 AND 5)                                    |
| create_time        | DATETIME |      | NOT NULL | CURRENT_TIMESTAMP | 创建时间   |                                                                  |
| update_time        | DATETIME |      | NOT NULL | CURRENT_TIMESTAMP | 更新时间   |                                                                  |

#### 5.1.10 采购单表 (purchase_orders)

| 字段名            | 数据类型 | 长度 | 是否为空 | 默认值            | 说明         | 约束                                                                               |
| ----------------- | -------- | ---- | -------- | ----------------- | ------------ | ---------------------------------------------------------------------------------- |
| purchase_id       | VARCHAR  | 20   | NOT NULL |                   | 采购单ID     | 主键                                                                               |
| purchase_no       | VARCHAR  | 30   | NOT NULL |                   | 采购单号     | 唯一索引                                                                           |
| supplier_id       | VARCHAR  | 10   | NOT NULL |                   | 供应商ID     | 外键                                                                               |
| total_amount      | DECIMAL  | 12,2 | NOT NULL | 0.00              | 总金额       |                                                                                    |
| status            | VARCHAR  | 20   | NOT NULL | 'draft'           | 状态         | CHECK(status IN ('draft','submitted','approved','ordered','received','cancelled')) |
| order_date        | DATE     |      |          |                   | 订购日期     |                                                                                    |
| expected_delivery | DATE     |      |          |                   | 预计送达日期 |                                                                                    |
| actual_delivery   | DATE     |      |          |                   | 实际送达日期 |                                                                                    |
| create_time       | DATETIME |      | NOT NULL | CURRENT_TIMESTAMP | 创建时间     |                                                                                    |
| create_by         | VARCHAR  | 10   | NOT NULL |                   | 创建人       |                                                                                    |
| approve_time      | DATETIME |      |          |                   | 审批时间     |                                                                                    |
| approve_by        | VARCHAR  | 10   |          |                   | 审批人       |                                                                                    |

#### 5.1.11 采购明细表 (purchase_details)

| 字段名            | 数据类型 | 长度 | 是否为空 | 默认值    | 说明       | 约束                                                            |
| ----------------- | -------- | ---- | -------- | --------- | ---------- | --------------------------------------------------------------- |
| detail_id         | VARCHAR  | 20   | NOT NULL |           | 明细ID     | 主键                                                            |
| purchase_id       | VARCHAR  | 20   | NOT NULL |           | 采购单ID   | 外键                                                            |
| isbn              | VARCHAR  | 20   | NOT NULL |           | 图书ISBN   | 外键                                                            |
| quantity          | INT      |      | NOT NULL | 1         | 采购数量   | CHECK(quantity > 0)                                             |
| unit_price        | DECIMAL  | 10,2 | NOT NULL |           | 采购单价   | CHECK(unit_price >= 0)                                          |
| received_quantity | INT      |      | NOT NULL | 0         | 已收货数量 | CHECK(received_quantity >= 0 AND received_quantity <= quantity) |
| status            | VARCHAR  | 20   | NOT NULL | 'pending' | 状态       | CHECK(status IN ('pending','partial','complete'))               |

### 5.2 辅助表设计

#### 5.2.1 缺书记录表 (out_of_stock_records)

| 字段名            | 数据类型 | 长度 | 是否为空 | 默认值            | 说明           | 约束                                                               |
| ----------------- | -------- | ---- | -------- | ----------------- | -------------- | ------------------------------------------------------------------ |
| record_id         | VARCHAR  | 20   | NOT NULL |                   | 记录ID         | 主键                                                               |
| isbn              | VARCHAR  | 20   | NOT NULL |                   | 图书ISBN       | 外键                                                               |
| book_title        | VARCHAR  | 200  |          |                   | 图书名称       | 冗余存储，便于查询                                                 |
| publisher_name    | VARCHAR  | 100  |          |                   | 出版社名称     | 冗余存储，便于查询                                                 |
| required_quantity | INT      |      | NOT NULL | 1                 | 需求数量       | CHECK(required_quantity > 0)                                       |
| customer_id       | VARCHAR  | 10   |          |                   | 客户ID         | 外键                                                               |
| customer_email    | VARCHAR  | 100  |          |                   | 客户邮箱       | 用于到货通知                                                       |
| customer_phone    | VARCHAR  | 20   |          |                   | 客户电话       | 用于到货通知                                                       |
| source_type       | VARCHAR  | 20   | NOT NULL | 'manual'          | 来源类型       | CHECK(source_type IN ('manual','auto','customer'))                 |
| priority          | INT      |      | NOT NULL | 1                 | 优先级         | CHECK(priority BETWEEN 1 AND 5)                                    |
| status            | VARCHAR  | 20   | NOT NULL | 'pending'         | 状态           | CHECK(status IN ('pending','processing','resolved','cancelled'))   |
| notify_status     | VARCHAR  | 20   | NOT NULL | 'not_required'    | 通知状态       | CHECK(notify_status IN ('not_required','pending','sent','failed')) |
| notify_time       | DATETIME |      |          |                   | 通知时间       |                                                                    |
| created_time      | DATETIME |      | NOT NULL | CURRENT_TIMESTAMP | 登记时间(创建) |                                                                    |
| resolve_time      | DATETIME |      |          |                   | 解决时间       |                                                                    |
| remark            | TEXT     |      |          |                   | 备注           | 客户的缺书请求说明                                                 |

**字段说明**：

- `customer_email`/`customer_phone`：当客户在网上进行缺书登记时记录联系方式，用于到货后通知
- `notify_status`：跟踪通知状态，`not_required`表示无需通知（非客户登记），`pending`待通知，`sent`已通知，`failed`通知失败
- `book_title`/`publisher_name`：冗余存储图书和出版社信息，即使图书信息变更也能保持记录准确性

#### 5.2.2 发货单表 (delivery_orders)

| 字段名           | 数据类型 | 长度 | 是否为空 | 默认值      | 说明         | 约束                                                                                  |
| ---------------- | -------- | ---- | -------- | ----------- | ------------ | ------------------------------------------------------------------------------------- |
| delivery_id      | VARCHAR  | 20   | NOT NULL |             | 发货单ID     | 主键                                                                                  |
| order_id         | VARCHAR  | 20   | NOT NULL |             | 订单ID       | 外键                                                                                  |
| delivery_no      | VARCHAR  | 30   | NOT NULL |             | 发货单号     | 唯一索引                                                                              |
| delivery_company | VARCHAR  | 50   | NOT NULL |             | 物流公司     |                                                                                       |
| tracking_no      | VARCHAR  | 50   |          |             | 物流单号     |                                                                                       |
| delivery_address | VARCHAR  | 200  | NOT NULL |             | 收货地址     |                                                                                       |
| delivery_status  | VARCHAR  | 20   | NOT NULL | 'preparing' | 发货状态     | CHECK(delivery_status IN ('preparing','shipped','in_transit','delivered','returned')) |
| shipping_fee     | DECIMAL  | 8,2  | NOT NULL | 0.00        | 运费         |                                                                                       |
| weight           | DECIMAL  | 8,2  |          |             | 重量(kg)     |                                                                                       |
| package_count    | INT      |      | NOT NULL | 1           | 包裹数量     |                                                                                       |
| prepare_time     | DATETIME |      |          |             | 配货时间     |                                                                                       |
| ship_time        | DATETIME |      |          |             | 发货时间     |                                                                                       |
| expected_arrival | DATE     |      |          |             | 预计到达日期 |                                                                                       |
| actual_arrival   | DATE     |      |          |             | 实际到达日期 |                                                                                       |
| notes            | TEXT     |      |          |             | 备注         |                                                                                       |

#### 5.2.3 发货明细表 (delivery_details)

| 字段名          | 数据类型 | 长度 | 是否为空 | 默认值 | 说明       | 约束                |
| --------------- | -------- | ---- | -------- | ------ | ---------- | ------------------- |
| detail_id       | VARCHAR  | 20   | NOT NULL |        | 明细ID     | 主键                |
| delivery_id     | VARCHAR  | 20   | NOT NULL |        | 发货单ID   | 外键                |
| order_detail_id | VARCHAR  | 20   | NOT NULL |        | 订单明细ID | 外键                |
| quantity        | INT      |      | NOT NULL | 1      | 发货数量   | CHECK(quantity > 0) |
| package_no      | VARCHAR  | 20   |          |        | 包裹编号   |                     |

#### 5.2.4 信用等级规则表 (credit_rules)

| 字段名             | 数据类型 | 长度 | 是否为空 | 默认值 | 说明             | 约束                                 |
| ------------------ | -------- | ---- | -------- | ------ | ---------------- | ------------------------------------ |
| level              | INT      |      | NOT NULL |        | 信用等级         | 主键                                 |
| level_name         | VARCHAR  | 20   | NOT NULL |        | 等级名称         |                                      |
| discount_rate      | DECIMAL  | 5,4  | NOT NULL | 0.0000 | 折扣率           | CHECK(discount_rate BETWEEN 0 AND 1) |
| overdraft_enabled  | BOOLEAN  |      | NOT NULL | FALSE  | 允许透支         |                                      |
| overdraft_limit    | DECIMAL  | 10,2 |          |        | 透支额度         |                                      |
| min_balance        | DECIMAL  | 10,2 |          |        | 最低账户余额要求 |                                      |
| min_total_purchase | DECIMAL  | 12,2 |          |        | 最低累计消费要求 |                                      |
| description        | TEXT     |      |          |        | 等级描述         |                                      |

**信用等级规则初始化数据**（根据需求规定）：

```sql
INSERT INTO credit_rules (level, level_name, discount_rate, overdraft_enabled, overdraft_limit, min_balance, min_total_purchase, description) VALUES
(1, '一级会员', 0.10, FALSE, NULL, NULL, 0.00, '10%折扣，不能透支'),
(2, '二级会员', 0.15, FALSE, NULL, NULL, 1000.00, '15%折扣，不能透支'),
(3, '三级会员', 0.15, TRUE, 500.00, NULL, 2000.00, '15%折扣，可透支500元'),
(4, '四级会员', 0.20, TRUE, 1000.00, NULL, 5000.00, '20%折扣，可透支1000元'),
(5, '五级会员', 0.25, TRUE, NULL, NULL, 10000.00, '25%折扣，透支无限额');
```

**等级说明**：

| 等级 | 折扣 | 透支权限 | 透支额度 | 升级条件（累计消费） |
| ---- | ---- | -------- | -------- | -------------------- |
| 一级 | 10%  | 不能透支 | -        | 新注册用户           |
| 二级 | 15%  | 不能透支 | -        | 累计消费≥1000元     |
| 三级 | 15%  | 可透支   | 500元    | 累计消费≥2000元     |
| 四级 | 20%  | 可透支   | 1000元   | 累计消费≥5000元     |
| 五级 | 25%  | 可透支   | 无限额   | 累计消费≥10000元    |

#### 5.2.5 关键字表 (keywords)

| 字段名       | 数据类型 | 长度 | 是否为空 | 默认值            | 说明     | 约束     |
| ------------ | -------- | ---- | -------- | ----------------- | -------- | -------- |
| keyword_id   | VARCHAR  | 10   | NOT NULL |                   | 关键字ID | 主键     |
| keyword      | VARCHAR  | 50   | NOT NULL |                   | 关键字   | 唯一索引 |
| search_count | INT      |      | NOT NULL | 0                 | 搜索次数 |          |
| create_time  | DATETIME |      | NOT NULL | CURRENT_TIMESTAMP | 创建时间 |          |

#### 5.2.6 图书关键字表 (book_keywords)

| 字段名     | 数据类型 | 长度 | 是否为空 | 默认值 | 说明     | 约束                             |
| ---------- | -------- | ---- | -------- | ------ | -------- | -------------------------------- |
| isbn       | VARCHAR  | 20   | NOT NULL |        | 图书ISBN | 外键,复合主键                    |
| keyword_id | VARCHAR  | 10   | NOT NULL |        | 关键字ID | 外键,复合主键                    |
| relevance  | DECIMAL  | 3,2  | NOT NULL | 1.00   | 相关度   | CHECK(relevance BETWEEN 0 AND 1) |

#### 5.2.7 类别表 (categories)

| 字段名        | 数据类型 | 长度 | 是否为空 | 默认值 | 说明     | 约束 |
| ------------- | -------- | ---- | -------- | ------ | -------- | ---- |
| category_id   | VARCHAR  | 10   | NOT NULL |        | 类别ID   | 主键 |
| category_name | VARCHAR  | 50   | NOT NULL |        | 类别名称 |      |
| parent_id     | VARCHAR  | 10   |          |        | 父类别ID | 外键 |
| level         | INT      |      | NOT NULL | 1      | 层级     |      |
| display_order | INT      |      | NOT NULL | 1      | 显示顺序 |      |
| description   | TEXT     |      |          |        | 描述     |      |

#### 5.2.8 图书类别表 (book_categories)

| 字段名      | 数据类型 | 长度 | 是否为空 | 默认值 | 说明     | 约束          |
| ----------- | -------- | ---- | -------- | ------ | -------- | ------------- |
| isbn        | VARCHAR  | 20   | NOT NULL |        | 图书ISBN | 外键,复合主键 |
| category_id | VARCHAR  | 10   | NOT NULL |        | 类别ID   | 外键,复合主键 |

#### 5.2.9 丛书表 (book_series)

| 字段名       | 数据类型 | 长度 | 是否为空 | 默认值 | 说明     | 约束 |
| ------------ | -------- | ---- | -------- | ------ | -------- | ---- |
| series_id    | VARCHAR  | 10   | NOT NULL |        | 丛书ID   | 主键 |
| series_name  | VARCHAR  | 100  | NOT NULL |        | 丛书名称 |      |
| publisher_id | VARCHAR  | 10   |          |        | 出版社ID | 外键 |
| total_books  | INT      |      |          |        | 总册数   |      |
| description  | TEXT     |      |          |        | 描述     |      |

#### 5.2.10 供应商图书表 (supplier_books)

| 字段名             | 数据类型 | 长度 | 是否为空 | 默认值            | 说明         | 约束                          |
| ------------------ | -------- | ---- | -------- | ----------------- | ------------ | ----------------------------- |
| supplier_id        | VARCHAR  | 10   | NOT NULL |                   | 供应商ID     | 外键,复合主键                 |
| isbn               | VARCHAR  | 20   | NOT NULL |                   | 图书ISBN     | 外键,复合主键                 |
| supply_price       | DECIMAL  | 10,2 | NOT NULL |                   | 供应价格     | CHECK(supply_price >= 0)      |
| min_order_quantity | INT      |      | NOT NULL | 1                 | 最小起订量   | CHECK(min_order_quantity > 0) |
| delivery_days      | INT      |      | NOT NULL | 7                 | 交货天数     | CHECK(delivery_days > 0)      |
| is_available       | BOOLEAN  |      | NOT NULL | TRUE              | 是否可供应   |                               |
| last_update        | DATETIME |      | NOT NULL | CURRENT_TIMESTAMP | 最后更新时间 |                               |

#### 5.2.11 采购缺书映射表 (purchase_shortage_map)

| 字段名          | 数据类型 | 长度 | 是否为空 | 默认值 | 说明       | 约束                       |
| --------------- | -------- | ---- | -------- | ------ | ---------- | -------------------------- |
| purchase_id     | VARCHAR  | 20   | NOT NULL |        | 采购单ID   | 外键,复合主键              |
| record_id       | VARCHAR  | 20   | NOT NULL |        | 缺书记录ID | 外键,复合主键              |
| mapped_quantity | INT      |      | NOT NULL | 1      | 映射数量   | CHECK(mapped_quantity > 0) |

**字段说明**：

- 该表实现缺书记录与采购单的M:N关系
- 一张采购单可覆盖多条缺书记录（多本书/多条需求）
- 一条缺书记录也可能被拆分到多次采购（分批到货、多个供应商）
- `mapped_quantity`：记录该采购单为该缺书记录采购的数量
