# EasyBook 网上书店管理系统 - 前端开发方案

> 项目名称：EasyBook (让阅读更简单)
>
> 设计日期：2025-01
>
> 技术栈：Vue 3 + Vuetify 3 + TypeScript + Pinia

---

## 一、项目概述

### 1.1 系统定位

EasyBook 是一个混合架构的网上书店管理系统：

- **前台 (B/S架构)**：面向普通客户的在线购书平台
- **后台 (C/S架构)**：面向管理员的书店管理系统

### 1.2 技术栈

| 技术 | 版本 | 用途 |
|------|------|------|
| Vue | 3.x | 前端框架 |
| Vuetify | 3.x | UI组件库 (Material Design) |
| TypeScript | 5.x | 类型系统 |
| Pinia | 2.x | 状态管理 |
| Vue Router | 4.x | 路由管理 |
| Axios | 1.x | HTTP客户端 |
| Vite | 5.x | 构建工具 |

### 1.3 设计风格

**主题配色：** 浅色书店风格

```css
/* 主要颜色 */
--primary-100: #f7cac9    /* 粉色 - 主要强调色 */
--primary-200: #5c5c5c    /* 灰色 */
--accent-100: #5c5c5c     /* 灰色 - 强调色 */
--accent-200: #ebebeb     /* 浅灰色 */

/* 文字颜色 */
--text-100: #333333       /* 深色文字 */
--text-200: #5c5c5c       /* 中等文字 */

/* 背景颜色 */
--bg-100: #fffff3         /* 米白色背景 */
--bg-200: #f5f5e9         /* 浅米色 */
--bg-300: #ccccc0         /* 灰米色 */
```

---

## 二、用户角色与权限

### 2.1 角色定义

```typescript
// 用户角色
enum UserRole {
  CUSTOMER = 'customer',  // 普通客户
  ADMIN = 'admin'         // 管理员
}

// 信用等级 (仅customer有)
enum CreditLevel {
  LEVEL_1 = 1,  // 10%折扣，不能透支
  LEVEL_2 = 2,  // 15%折扣，不能透支 (累计消费≥1000元)
  LEVEL_3 = 3,  // 15%折扣，透支500元 (累计消费≥2000元)
  LEVEL_4 = 4,  // 20%折扣，透支1000元 (累计消费≥5000元)
  LEVEL_5 = 5   // 25%折扣，透支无限额 (累计消费≥10000元)
}
```

### 2.2 权限控制策略

1. **路由级别**：通过 `meta.requiresAuth` 和 `meta.requiresAdmin` 控制
2. **组件级别**：使用 `v-if` 结合权限判断
3. **API级别**：后端 token 验证

### 2.3 信用等级规则

| 等级 | 折扣 | 透支权限 | 透支额度 | 升级条件 |
|------|------|----------|----------|----------|
| 1级 | 10% | 不能透支 | - | 新注册用户 |
| 2级 | 15% | 不能透支 | - | 累计消费≥1000元 |
| 3级 | 15% | 可透支 | 500元 | 累计消费≥2000元 |
| 4级 | 20% | 可透支 | 1000元 | 累计消费≥5000元 |
| 5级 | 25% | 可透支 | 无限额 | 累计消费≥10000元 |

**升级机制：**
- 自动升级：系统定期执行 `sp_auto_adjust_credit_level` 存储过程
- 累计消费：基于 `customers.total_purchase` 字段
- 不可降级：信用等级只升不降

---

## 三、页面结构与路由设计

### 3.1 前台用户页面 (B/S)

#### 3.1.1 公共页面
```
/                         # 首页 (重定向到 /books)
/auth/login               # 登录页面 ✓
/auth/register            # 注册页面 ✓
```

#### 3.1.2 图书浏览模块
```
/books                    # 图书列表页
├─ 功能：
│  ├─ 搜索与筛选 (按分类、作者、出版社、价格区间)
│  ├─ 全文搜索 (书名、关键字)
│  ├─ 分页与排序 (按价格、出版日期、销量)
│  └─ 列表/网格视图切换

/books/:isbn              # 图书详情页
├─ 功能：
│  ├─ 基本信息展示
│  ├─ 多作者显示 (有序，最多4个)
│  ├─ 库存状态 (实时可用库存 = quantity - reserved_quantity)
│  ├─ 价格显示 (原价 + 折扣价)
│  ├─ 加入购物车 / 立即购买
│  └─ 相关推荐 (同作者/同分类/同丛书)
```

#### 3.1.3 购物与订单模块
```
/cart                     # 购物车页面
├─ 功能：
│  ├─ 商品列表 (显示书名、单价、数量、小计)
│  ├─ 数量调整 / 删除商品
│  ├─ 实时价格计算 (含信用折扣)
│  ├─ 库存检查提示
│  └─ 去结算按钮

/checkout                 # 结算页面
├─ 功能：
│  ├─ 收货地址选择/新增
│  ├─ 订单商品清单
│  ├─ 价格明细 (原价、折扣金额、应付金额、运费)
│  ├─ 余额显示 + 透支提示
│  ├─ 支付方式选择
│  └─ 提交订单

/orders                   # 我的订单列表
├─ 功能：
│  ├─ 订单筛选 (按状态: pending/paid/shipped/delivered/cancelled)
│  ├─ 订单搜索 (订单号)
│  └─ 分页展示

/orders/:orderId          # 订单详情页
├─ 功能：
│  ├─ 订单基本信息 (订单号、下单时间、状态)
│  ├─ 收货信息
│  ├─ 订单明细 (图书、数量、单价、小计)
│  ├─ 价格汇总
│  ├─ 物流跟踪 (如已发货)
│  └─ 操作按钮 (支付/取消订单/确认收货)
```

#### 3.1.4 用户中心模块
```
/profile                  # 个人资料 ✓
├─ 功能：
│  ├─ 基本信息维护
│  └─ 修改密码

/account                  # 账户管理
├─ 功能：
│  ├─ 余额显示
│  ├─ 充值功能
│  ├─ 信用等级展示 (当前等级、折扣率、透支额度)
│  ├─ 升级进度条 (距离下一级还需消费XX元)
│  ├─ 消费统计 (累计消费、本月消费)
│  └─ 交易记录

/addresses                # 收货地址管理
├─ 功能：
│  ├─ 地址列表
│  ├─ 新增/编辑/删除
│  └─ 设为默认地址
```

#### 3.1.5 缺书登记模块
```
/out-of-stock             # 缺书登记
├─ 功能：
│  ├─ 搜索想要的图书 (全文搜索)
│  ├─ 登记缺书请求 (图书、数量、备注)
│  ├─ 我的缺书登记列表
│  └─ 到货通知状态
```

---

### 3.2 后台管理页面 (C/S)

#### 3.2.1 仪表板
```
/dashboard                # 管理员首页 ✓
├─ 功能：
│  ├─ 今日/本月销售概览 (营业额、订单数、客单价)
│  ├─ 待处理订单数量 (pending/paid)
│  ├─ 库存预警数量 (低于安全库存)
│  ├─ 缺书记录待处理数 (status=pending)
│  ├─ 销售趋势图表 (折线图)
│  └─ 畅销图书排行 (Top 10)
```

#### 3.2.2 图书管理
```
/admin/books              # 图书列表
├─ 功能：
│  ├─ 搜索与筛选 (ISBN/书名/作者/出版社/状态)
│  ├─ 新增图书按钮
│  ├─ 编辑/删除操作
│  ├─ 批量导入 (CSV/Excel)
│  └─ 库存快捷查看

/admin/books/create       # 新增图书
├─ 表单字段：
│  ├─ 基本信息 (ISBN、书名、版次、定价、页数、语言等)
│  ├─ 出版社选择 (下拉选择 + 新增)
│  ├─ 作者关联 (多选，有序，最多4个，支持新增)
│  ├─ 分类选择 (树形多选，支持多分类)
│  ├─ 关键字标签 (最多10个，自动补全)
│  ├─ 丛书关联 (下拉选择 + 新增)
│  ├─ 出版日期
│  ├─ 简介/目录 (富文本编辑器)
│  ├─ 封面图片上传
│  └─ 初始库存设置

/admin/books/:isbn/edit   # 编辑图书
├─ 功能：同新增，预填充数据
```

#### 3.2.3 作者与出版社管理
```
/admin/authors            # 作者管理
├─ 功能：
│  ├─ 列表 (姓名、国籍、图书数量)
│  ├─ 新增/编辑/删除
│  └─ 查看作者的所有图书

/admin/publishers         # 出版社管理
├─ 功能：
│  ├─ 列表 (名称、联系人、电话、邮箱)
│  ├─ 新增/编辑/删除
│  └─ 查看出版社的所有图书
```

#### 3.2.4 库存管理
```
/admin/inventory          # 库存列表
├─ 功能：
│  ├─ 库存状态筛选 (正常/偏低/缺货)
│  ├─ 搜索 (ISBN/书名)
│  ├─ 排序 (按可用库存/预留数量)
│  ├─ 库存调整操作 (入库/出库/盘点)
│  └─ 安全库存设置

/admin/inventory/:isbn    # 库存详情
├─ 功能：
│  ├─ 图书基本信息
│  ├─ 库存数据展示
│  │  ├─ 当前库存 (quantity)
│  │  ├─ 预留数量 (reserved_quantity)
│  │  ├─ 可用库存 (quantity - reserved_quantity)
│  │  └─ 安全库存 (safety_stock)
│  ├─ 库存变动历史记录 (表格)
│  ├─ 库存调整表单 (入库/出库/盘点)
│  └─ 关联缺书记录
```

#### 3.2.5 订单管理
```
/admin/orders             # 订单列表
├─ 功能：
│  ├─ 状态筛选 (全部/待支付/已支付/已发货/已完成/已取消)
│  ├─ 搜索 (订单号/客户姓名/手机号)
│  ├─ 时间范围筛选
│  ├─ 批量操作 (批量发货/导出)
│  └─ 快捷操作 (查看详情/发货/取消)

/admin/orders/:orderId    # 订单详情
├─ 功能：
│  ├─ 订单基本信息 (订单号、客户、状态、时间)
│  ├─ 收货信息
│  ├─ 订单明细表格
│  ├─ 价格汇总 (原价、折扣、应付)
│  ├─ 状态流转操作
│  │  ├─ 支付确认 (pending → paid)
│  │  ├─ 发货 (paid → shipped，需填写物流信息)
│  │  ├─ 确认送达 (shipped → delivered)
│  │  └─ 取消订单 (释放库存、退款)
│  └─ 操作日志
```

#### 3.2.6 采购管理
```
/admin/purchases          # 采购单列表
├─ 功能：
│  ├─ 状态筛选 (草稿/已提交/已审批/已订购/已收货/已取消)
│  ├─ 搜索 (采购单号/供应商)
│  ├─ 新建采购单按钮
│  └─ 快捷操作 (查看/审批/收货)

/admin/purchases/create   # 新建采购单
├─ 功能：
│  ├─ 选择供应商
│  ├─ 基于缺书记录添加明细 (推荐列表)
│  ├─ 手工添加图书明细
│  │  ├─ 搜索图书
│  │  ├─ 选择供应商报价 (同一本书可能多个供应商)
│  │  ├─ 输入采购数量、单价
│  │  └─ 自动计算总金额
│  ├─ 预计交货日期
│  ├─ 备注说明
│  └─ 保存草稿/提交审批

/admin/purchases/:id      # 采购单详情
├─ 功能：
│  ├─ 采购单基本信息
│  ├─ 供应商信息
│  ├─ 采购明细表格 (图书、数量、单价、已收货数量)
│  ├─ 状态流转操作
│  │  ├─ 提交审批 (draft → submitted)
│  │  ├─ 审批通过/驳回 (submitted → approved/draft)
│  │  ├─ 确认订购 (approved → ordered)
│  │  ├─ 收货登记 (ordered → received，部分收货)
│  │  └─ 取消采购
│  ├─ 关联缺书记录 (purchase_shortage_map)
│  └─ 审批历史
```

#### 3.2.7 供应商管理
```
/admin/suppliers          # 供应商列表
├─ 功能：
│  ├─ 列表 (名称、联系人、电话、合作状态、评分)
│  ├─ 搜索与筛选
│  ├─ 新增/编辑/删除
│  └─ 快捷操作 (查看详情/停用)

/admin/suppliers/:id      # 供应商详情
├─ 功能：
│  ├─ 基本信息编辑
│  ├─ 供应图书列表 (supplier_books表)
│  │  ├─ 添加可供图书 (搜索图书)
│  │  ├─ 设置供应价格、最小起订量、交货天数
│  │  └─ 启用/停用供应
│  ├─ 合作状态管理 (active/suspended/terminated)
│  ├─ 评分管理
│  └─ 采购历史记录
```

#### 3.2.8 缺书管理
```
/admin/out-of-stock       # 缺书记录管理
├─ 功能：
│  ├─ 记录列表
│  ├─ 筛选 (按来源: manual/auto/customer，按状态: pending/processing/resolved)
│  ├─ 搜索 (ISBN/书名)
│  ├─ 排序 (按优先级、需求数量、登记时间)
│  ├─ 生成采购建议 (批量生成采购单)
│  ├─ 批量处理 (标记处理中/已解决)
│  └─ 到货通知发送 (客户登记的)

/admin/out-of-stock/:id   # 缺书记录详情
├─ 功能：
│  ├─ 记录基本信息
│  ├─ 客户信息 (如果是客户登记)
│  ├─ 图书信息
│  ├─ 需求数量与优先级
│  ├─ 供应商报价对比
│  ├─ 关联采购单 (如已生成)
│  ├─ 操作
│  │  ├─ 更新状态
│  │  ├─ 调整数量/优先级
│  │  ├─ 创建采购单
│  │  └─ 发送到货通知
│  └─ 处理日志
```

#### 3.2.9 客户管理
```
/admin/customers          # 客户列表
├─ 功能：
│  ├─ 搜索与筛选 (用户名/姓名/邮箱/信用等级/账户状态)
│  ├─ 列表展示 (ID、用户名、姓名、信用等级、余额、累计消费、注册日期)
│  ├─ 快捷操作 (查看详情/冻结/解冻)
│  └─ 导出功能

/admin/customers/:id      # 客户详情
├─ 功能：
│  ├─ 基本信息展示
│  ├─ 信用等级信息
│  │  ├─ 当前等级与折扣率
│  │  ├─ 透支额度
│  │  ├─ 升级进度
│  │  └─ 手动调整等级 (管理员权限)
│  ├─ 账户操作
│  │  ├─ 账户余额
│  │  ├─ 充值操作
│  │  ├─ 扣款操作 (需备注原因)
│  │  └─ 冻结/解冻账户
│  ├─ 消费统计
│  │  ├─ 累计消费
│  │  ├─ 订单数量
│  │  ├─ 平均客单价
│  │  └─ 消费趋势图
│  ├─ 订单历史 (表格，可跳转订单详情)
│  ├─ 收货地址列表
│  └─ 缺书登记记录
```

#### 3.2.10 统计分析
```
/admin/stats              # 统计报表 ✓
├─ 销售统计
│  ├─ 时间维度 (日/周/月/年)
│  ├─ 销售额趋势图
│  ├─ 订单量统计
│  ├─ 客单价分析
│  └─ Top图书排行

├─ 客户统计
│  ├─ 新增用户趋势
│  ├─ 活跃用户统计
│  ├─ 信用等级分布 (饼图)
│  └─ 客户地域分布

├─ 库存统计
│  ├─ 库存总值
│  ├─ 库存周转率
│  ├─ 缺货次数统计
│  └─ 滞销图书分析

└─ 财务统计
   ├─ 营业额统计
   ├─ 采购成本
   ├─ 毛利分析
   └─ 账户余额汇总
```

#### 3.2.11 系统设置
```
/admin/settings           # 系统设置 ✓
├─ 信用等级规则配置
│  ├─ 查看信用等级表 (credit_rules)
│  └─ 修改折扣率、透支额度、升级阈值

├─ 运费规则配置
│  ├─ 免运费条件
│  └─ 运费计算规则

└─ 系统参数
   ├─ 安全库存默认值
   ├─ 预留库存超时释放时间
   └─ 订单自动取消时间
```

---

## 四、API接口设计

### 4.1 接口规范

**基础URL:** `http://localhost:8080/api`

**请求头:**
```
Content-Type: application/json
Authorization: Bearer <token>
```

**统一响应格式:**
```typescript
interface ApiResponse<T> {
  code: number        // 状态码 (200成功, 400参数错误, 401未授权, 500服务器错误)
  message: string     // 提示信息
  data?: T           // 响应数据
  timestamp: string  // 时间戳
}
```

### 4.2 认证接口

```typescript
// 用户注册
POST /api/auth/register
Request: {
  username: string
  password: string
  email: string
  real_name: string
  phone?: string
}
Response: {
  customer_id: string
  username: string
}

// 用户登录
POST /api/auth/login
Request: {
  username: string
  password: string
}
Response: {
  access_token: string
  user: {
    customer_id: string
    username: string
    email: string
    real_name: string
    is_admin: boolean
    credit_level: number
    account_balance: number
  }
}

// 获取当前用户信息
GET /api/auth/profile
Response: User

// 更新用户资料
PUT /api/auth/profile
Request: {
  real_name?: string
  phone?: string
  address?: string
}

// 修改密码
POST /api/auth/change-password
Request: {
  current_password: string
  new_password: string
}
```

### 4.3 图书接口

```typescript
// 图书列表 (分页、搜索、筛选)
GET /api/books
Query: {
  page?: number          // 页码，默认1
  page_size?: number     // 每页数量，默认20
  keyword?: string       // 搜索关键字 (书名、作者、ISBN)
  category_id?: string   // 分类ID
  publisher_id?: string  // 出版社ID
  min_price?: number     // 最低价格
  max_price?: number     // 最高价格
  status?: string        // 状态 (active/out_of_stock)
  sort?: string          // 排序 (price_asc/price_desc/publish_date_desc/sales_desc)
}
Response: {
  items: Book[]
  total: number
  page: number
  page_size: number
}

// 图书详情
GET /api/books/:isbn
Response: {
  ...Book,
  authors: Author[]           // 有序作者列表
  publisher: Publisher
  categories: Category[]
  keywords: Keyword[]
  series?: BookSeries
  inventory: {
    quantity: number
    reserved_quantity: number
    available_quantity: number  // quantity - reserved_quantity
    safety_stock: number
    status: 'normal' | 'low' | 'out_of_stock'
  }
}

// 新增图书 (管理员)
POST /api/books
Request: {
  isbn: string
  title: string
  publisher_id: string
  price: number
  authors: { author_id: string, author_order: number }[]  // 最多4个
  categories: string[]        // category_id数组
  keywords: string[]          // keyword数组，最多10个
  series_id?: string
  publish_date?: string
  page_count?: number
  language?: string
  description?: string
  table_of_contents?: string
  cover_image?: string
  initial_stock?: number      // 初始库存
  safety_stock?: number       // 安全库存
}

// 更新图书 (管理员)
PUT /api/books/:isbn
Request: 同新增 (可选字段)

// 删除图书 (管理员)
DELETE /api/books/:isbn

// 全文搜索
GET /api/books/search
Query: {
  q: string              // 搜索词
  page?: number
  page_size?: number
}

// 相关图书推荐
GET /api/books/:isbn/related
Query: {
  type?: 'author' | 'category' | 'series'  // 推荐类型
  limit?: number         // 数量限制，默认10
}
```

### 4.4 购物车接口

```typescript
// 获取购物车
GET /api/cart
Response: {
  items: CartItem[]
  total_items: number
  total_amount: number          // 原价合计
  discount_amount: number       // 折扣金额
  final_amount: number          // 应付金额
  discount_rate: number         // 当前用户折扣率
}

// 添加商品到购物车
POST /api/cart/items
Request: {
  isbn: string
  quantity: number
}
Response: CartItem

// 更新购物车商品数量
PUT /api/cart/items/:itemId
Request: {
  quantity: number
}

// 移除购物车商品
DELETE /api/cart/items/:itemId

// 清空购物车
DELETE /api/cart
```

### 4.5 订单接口

```typescript
// 订单列表
GET /api/orders
Query: {
  page?: number
  page_size?: number
  status?: string        // pending/paid/shipped/delivered/cancelled
  start_date?: string
  end_date?: string
}
Response: {
  items: Order[]
  total: number
}

// 订单详情
GET /api/orders/:orderId
Response: {
  ...Order,
  customer: { customer_id, real_name, phone }
  details: OrderDetail[]     // 订单明细
  delivery?: DeliveryOrder   // 发货信息 (如已发货)
}

// 创建订单 (从购物车结算)
POST /api/orders
Request: {
  shipping_address: string
  recipient_name: string
  recipient_phone: string
  payment_method?: string
  notes?: string
}
Response: {
  order_id: string
  order_no: string
  actual_amount: number
}

// 支付订单
POST /api/orders/:orderId/pay
Request: {
  payment_method: string
}
Response: {
  order_status: string
  payment_time: string
}

// 取消订单
POST /api/orders/:orderId/cancel
Request: {
  reason?: string
}

// 确认收货
POST /api/orders/:orderId/confirm

// 发货 (管理员)
POST /api/admin/orders/:orderId/ship
Request: {
  delivery_company: string
  tracking_no: string
}
Response: {
  delivery_id: string
  delivery_no: string
}
```

### 4.6 库存接口

```typescript
// 库存列表 (管理员)
GET /api/admin/inventory
Query: {
  page?: number
  page_size?: number
  status?: 'normal' | 'low' | 'out_of_stock'
  keyword?: string       // ISBN或书名
  sort?: string          // available_quantity_asc/desc
}
Response: {
  items: InventoryItem[]
  total: number
}

// 库存详情
GET /api/admin/inventory/:isbn
Response: {
  ...Inventory,
  book: Book,
  history: InventoryHistory[]  // 库存变动历史
  related_shortages: OutOfStockRecord[]
}

// 更新库存 (管理员 - 入库/出库/盘点)
PUT /api/admin/inventory/:isbn
Request: {
  operation: 'in' | 'out' | 'check'
  quantity: number
  reason: string
  location_code?: string
}

// 低库存预警列表
GET /api/admin/inventory/low-stock
Response: InventoryItem[]
```

### 4.7 采购接口

```typescript
// 采购单列表 (管理员)
GET /api/admin/purchases
Query: {
  page?: number
  status?: string        // draft/submitted/approved/ordered/received/cancelled
  supplier_id?: string
  start_date?: string
  end_date?: string
}

// 创建采购单
POST /api/admin/purchases
Request: {
  supplier_id: string
  details: {
    isbn: string
    quantity: number
    unit_price: number
  }[]
  expected_delivery?: string
  notes?: string
  shortage_ids?: string[]    // 关联的缺书记录ID
}
Response: {
  purchase_id: string
  purchase_no: string
}

// 采购单详情
GET /api/admin/purchases/:id
Response: {
  ...PurchaseOrder,
  supplier: Supplier,
  details: PurchaseDetail[],
  related_shortages: OutOfStockRecord[]
}

// 审批采购单
PUT /api/admin/purchases/:id/approve
Request: {
  approved: boolean
  comment?: string
}

// 收货登记
POST /api/admin/purchases/:id/receive
Request: {
  details: {
    detail_id: string
    received_quantity: number
  }[]
  actual_delivery?: string
}
```

### 4.8 供应商接口

```typescript
// 供应商列表
GET /api/admin/suppliers
Query: {
  page?: number
  status?: string        // active/suspended/terminated
  keyword?: string
}

// 新增供应商
POST /api/admin/suppliers
Request: {
  supplier_name: string
  contact_person: string
  contact_phone: string
  email: string
  address: string
  bank_account?: string
  tax_number?: string
}

// 更新供应商
PUT /api/admin/suppliers/:id
Request: 同新增 (可选字段)

// 删除供应商
DELETE /api/admin/suppliers/:id

// 供应商提供的图书列表
GET /api/admin/suppliers/:id/books
Response: {
  items: {
    ...SupplierBook,
    book: Book
  }[]
}

// 添加供应图书
POST /api/admin/suppliers/:id/books
Request: {
  isbn: string
  supply_price: number
  min_order_quantity: number
  delivery_days: number
}
```

### 4.9 缺书接口

```typescript
// 缺书记录列表
GET /api/admin/out-of-stock
Query: {
  page?: number
  source_type?: string   // manual/auto/customer
  status?: string        // pending/processing/resolved/cancelled
  priority?: number
  keyword?: string       // ISBN或书名
}

// 登记缺书 (客户/管理员)
POST /api/out-of-stock
Request: {
  isbn: string
  required_quantity: number
  remark?: string
  priority?: number      // 管理员可设置优先级
}

// 更新缺书记录 (管理员)
PUT /api/admin/out-of-stock/:id
Request: {
  status?: string
  priority?: number
  required_quantity?: number
}

// 发送到货通知
POST /api/admin/out-of-stock/:id/notify

// 批量生成采购单
POST /api/admin/out-of-stock/generate-purchase
Request: {
  record_ids: string[]
  supplier_id: string
}
Response: {
  purchase_id: string
}
```

### 4.10 客户账户接口

```typescript
// 账户充值
POST /api/account/recharge
Request: {
  amount: number
  payment_method: string
}

// 查询余额
GET /api/account/balance
Response: {
  account_balance: number
  credit_level: number
  overdraft_limit: number
  available_balance: number  // 余额 + 透支额度
}

// 交易记录
GET /api/account/transactions
Query: {
  page?: number
  type?: string         // recharge/payment/refund
  start_date?: string
  end_date?: string
}

// 信用等级信息
GET /api/account/credit-info
Response: {
  current_level: number
  level_name: string
  discount_rate: number
  overdraft_enabled: boolean
  overdraft_limit: number
  total_purchase: number
  next_level?: {
    level: number
    required_purchase: number
    remaining: number    // 还需消费金额
  }
}
```

### 4.11 统计接口

```typescript
// 仪表板数据
GET /api/admin/stats/dashboard
Response: {
  today_sales: number
  today_orders: number
  pending_orders: number
  low_stock_count: number
  pending_shortage_count: number
  sales_trend: { date: string, amount: number }[]
  top_books: { isbn: string, title: string, sales: number }[]
}

// 销售统计
GET /api/admin/stats/sales
Query: {
  start_date: string
  end_date: string
  group_by?: 'day' | 'week' | 'month'
  dimension?: 'time' | 'book' | 'category'
}

// 客户统计
GET /api/admin/stats/customers
Query: {
  start_date: string
  end_date: string
}
Response: {
  new_users: number
  active_users: number
  credit_distribution: { level: number, count: number }[]
  region_distribution: { region: string, count: number }[]
}

// 库存统计
GET /api/admin/stats/inventory
Response: {
  total_value: number
  turnover_rate: number
  shortage_count: number
  slow_moving_books: { isbn: string, title: string, days: number }[]
}
```

---

## 五、组件架构设计

### 5.1 通用组件 (src/components/common/)

```
✓ MetricCard.vue          # 指标卡片 (已有)
✓ StatusChip.vue          # 状态标签 (已有)
✗ DataTable.vue           # 通用表格组件
   Props: {
     headers: TableHeader[]
     items: any[]
     loading: boolean
     sortable: boolean
     filterable: boolean
     pagination: boolean
     actions: TableAction[]
   }

✗ SearchBar.vue           # 统一搜索栏
   Props: {
     placeholder: string
     filters: Filter[]      // 可选筛选条件
     onSearch: (keyword, filters) => void
   }

✗ BookCard.vue            # 图书卡片展示
   Props: {
     book: Book
     showStock: boolean
     showActions: boolean   // 加购物车/详情按钮
   }

✗ PriceDisplay.vue        # 价格显示组件
   Props: {
     originalPrice: number
     discountRate: number   // 折扣率
     showDiscount: boolean  // 显示折扣标签
   }

✗ CreditBadge.vue         # 信用等级徽章
   Props: {
     level: number
     size: 'small' | 'medium' | 'large'
     showDetail: boolean    // 显示折扣率等详情
   }

✗ AddressForm.vue         # 收货地址表单
   Props: {
     modelValue: Address
     mode: 'create' | 'edit'
   }
   Emits: {
     'update:modelValue': Address
     'save': Address
   }

✗ ConfirmDialog.vue       # 确认对话框
   Props: {
     title: string
     message: string
     confirmText: string
     cancelText: string
     type: 'info' | 'warning' | 'error'
   }
   Emits: {
     'confirm': void
     'cancel': void
   }

✗ ImageUploader.vue       # 图片上传组件
   Props: {
     modelValue: string     // 图片URL
     maxSize: number        // 最大尺寸(MB)
     accept: string         // 接受的格式
   }
   Emits: {
     'update:modelValue': string
   }

✗ Pagination.vue          # 分页组件
   Props: {
     total: number
     page: number
     pageSize: number
   }
   Emits: {
     'update:page': number
     'update:pageSize': number
   }

✗ LoadingOverlay.vue      # 加载遮罩
   Props: {
     loading: boolean
     message?: string
   }
```

### 5.2 业务组件 (src/components/business/)

```
✗ BookSearchPanel.vue     # 图书搜索面板
   - 关键字搜索框
   - 分类树形选择
   - 出版社选择
   - 价格区间滑块
   - 排序选择

✗ CartItem.vue            # 购物车商品项
   - 图书信息展示 (封面、书名、作者)
   - 单价与折扣价
   - 数量调整器 (+/-)
   - 小计显示
   - 删除按钮

✗ OrderSummary.vue        # 订单摘要
   - 商品列表
   - 价格明细 (原价、折扣、运费、应付)
   - 收货信息
   - 订单状态

✗ OrderTimeline.vue       # 订单状态时间线
   - 下单 → 支付 → 发货 → 送达
   - 每个节点显示时间
   - 当前状态高亮

✗ InventoryStatus.vue     # 库存状态指示器
   Props: {
     quantity: number
     reserved: number
     safetyStock: number
   }
   - 显示库存状态 (充足/偏低/缺货)
   - 进度条 (可用库存/总库存)
   - 颜色编码 (绿/黄/红)

✗ CreditProgress.vue      # 信用等级进度条
   Props: {
     currentLevel: number
     totalPurchase: number
   }
   - 当前等级展示
   - 升级进度条
   - 下一级所需消费金额提示

✗ AuthorSelector.vue      # 作者选择器 (支持有序多选)
   Props: {
     modelValue: { author_id: string, author_order: number }[]
     maxAuthors: number     // 最多4个
   }
   - 搜索作者
   - 拖拽排序
   - 添加新作者

✗ KeywordSelector.vue     # 关键字选择器
   Props: {
     modelValue: string[]
     maxKeywords: number    // 最多10个
   }
   - 自动补全
   - 标签展示
   - 快捷添加

✗ CategoryTree.vue        # 分类树形选择
   Props: {
     modelValue: string[]   // 已选分类ID
     multiple: boolean      // 多选
   }
   - 树形展示
   - 支持搜索
   - 面包屑导航
```

### 5.3 布局组件 (src/components/layouts/)

```
✓ AppLayout.vue           # 主应用布局 (已有,需调整)
   - 顶部导航栏 (app-bar)
   - 侧边栏 (navigation-drawer)
   - 主内容区 (main)
   - 用户菜单 (头像/退出)

✓ AuthLayout.vue          # 认证页面布局 (已有)
   - 居中卡片布局
   - 背景渐变
   - 响应式设计

✗ CustomerLayout.vue      # 前台客户布局 (可选,或复用AppLayout)
   - 顶部导航: 首页/图书/订单/购物车/用户中心
   - 搜索栏
   - 购物车图标 (显示数量)
```

---

## 六、状态管理设计 (Pinia Stores)

### 6.1 auth Store (src/stores/auth.ts) ✓

```typescript
// 已有,需扩展
interface AuthState {
  token: string | null
  user: User | null
  isAuthenticated: boolean
}

interface User {
  customer_id: string
  username: string
  email: string
  real_name: string
  is_admin: boolean
  credit_level: number        // 新增
  account_balance: number     // 新增
  total_purchase: number      // 新增
}

// Actions
- login(username, password)
- logout()
- register(userData)
- fetchUserProfile()
- updateProfile(data)
- changePassword(current, newPassword)

// Getters
- isAdmin                     // 是否管理员
- creditInfo                  // 信用等级详情
- canOverdraft               // 是否可透支
- overdraftLimit             // 透支额度
```

### 6.2 cart Store (src/stores/cart.ts) ✗

```typescript
interface CartState {
  items: CartItem[]
  loading: boolean
}

interface CartItem {
  item_id: string
  isbn: string
  title: string
  cover_image: string
  authors: string             // 作者名称字符串
  unit_price: number
  quantity: number
  discount_rate: number
  subtotal: number
  available_stock: number     // 可用库存
}

// Actions
- fetchCart()                 // 获取购物车
- addItem(isbn, quantity)     // 添加商品
- updateQuantity(itemId, quantity)
- removeItem(itemId)
- clearCart()
- checkout()                  // 结算 (创建订单)

// Getters
- totalItems                  // 商品总数
- totalAmount                 // 原价合计
- discountAmount              // 折扣金额
- finalAmount                 // 应付金额
- isEmpty                     // 是否为空
```

### 6.3 books Store (src/stores/books.ts) ✗

```typescript
interface BooksState {
  categories: Category[]
  publishers: Publisher[]
  keywords: Keyword[]
  searchHistory: string[]     // 搜索历史 (本地缓存)
  filters: BookFilters        // 当前筛选条件
}

interface BookFilters {
  keyword?: string
  category_id?: string
  publisher_id?: string
  min_price?: number
  max_price?: number
  sort?: string
}

// Actions
- fetchCategories()
- fetchPublishers()
- fetchKeywords()
- addSearchHistory(keyword)
- clearSearchHistory()
- setFilters(filters)

// Getters
- categoryTree                // 树形分类
- topSearchKeywords           // 热门搜索 (基于search_count)
```

### 6.4 orders Store (src/stores/orders.ts) ✗

```typescript
interface OrdersState {
  orders: Order[]
  currentOrder: OrderDetail | null
  pagination: {
    page: number
    page_size: number
    total: number
  }
}

// Actions
- fetchOrders(params)
- fetchOrderDetail(orderId)
- createOrder(orderData)
- payOrder(orderId, paymentMethod)
- cancelOrder(orderId, reason)
- confirmDelivery(orderId)

// Getters
- pendingOrders               // 待支付订单
- processingOrders            // 处理中订单
- completedOrders             // 已完成订单
```

### 6.5 app Store (src/stores/app.ts) ✗

```typescript
interface AppState {
  loading: boolean
  notifications: Notification[]
  creditRules: CreditRule[]   // 信用等级规则
  systemConfig: SystemConfig
}

interface Notification {
  id: string
  type: 'success' | 'info' | 'warning' | 'error'
  message: string
  duration?: number
}

// Actions
- setLoading(loading)
- showNotification(notification)
- dismissNotification(id)
- fetchCreditRules()
- fetchSystemConfig()

// Getters
- getCreditRule(level)        // 获取指定等级规则
- defaultShippingFee          // 默认运费
```

### 6.6 admin Store (src/stores/admin.ts) ✗

```typescript
// 管理员专用状态
interface AdminState {
  dashboard: DashboardData
  pendingCount: {
    orders: number
    purchases: number
    shortages: number
  }
}

// Actions
- fetchDashboard()
- fetchPendingCounts()

// Getters
- needsAttention              // 需要处理的事项数量
```

---

## 七、实施计划

### 阶段一: 基础搭建 (第1-2周)
**优先级: P0 (必须)**

#### 第1周
- [x] 项目基础结构调整
- [x] 配色主题应用
- [x] 布局框架完善
- [ ] API层重构
  - [ ] 完整接口定义 (src/api/modules/)
  - [ ] 统一错误处理
  - [ ] 请求/响应拦截器
- [ ] 认证模块完善
  - [ ] 扩展auth store (信用等级字段)
  - [ ] 路由守卫增强
  - [ ] Token刷新机制

#### 第2周
- [ ] 核心通用组件开发
  - [ ] DataTable (分页/排序/筛选)
  - [ ] SearchBar
  - [ ] ConfirmDialog
  - [ ] LoadingOverlay
  - [ ] Pagination
- [ ] 类型定义 (src/types/)
  - [ ] Book, Order, Customer等接口定义
  - [ ] API请求/响应类型

---

### 阶段二: 前台用户功能 (第3-5周)
**优先级: P0 (必须)**

#### 第3周: 图书浏览模块
- [ ] 图书列表页 (/books)
  - [ ] BookCard组件
  - [ ] BookSearchPanel组件
  - [ ] 搜索与筛选功能
  - [ ] 分页与排序
  - [ ] 列表/网格切换
- [ ] 图书详情页 (/books/:isbn)
  - [ ] 详细信息展示
  - [ ] 多作者展示
  - [ ] 库存状态显示
  - [ ] PriceDisplay组件 (含折扣)
  - [ ] 加入购物车/立即购买
- [ ] books store
  - [ ] 分类/出版社/关键字数据

#### 第4周: 购物车与结算
- [ ] 购物车页面 (/cart)
  - [ ] CartItem组件
  - [ ] 数量调整
  - [ ] 实时价格计算
  - [ ] 去结算按钮
- [ ] 结算页面 (/checkout)
  - [ ] AddressForm组件
  - [ ] 地址选择/新增
  - [ ] OrderSummary组件
  - [ ] 价格明细展示
  - [ ] 余额/透支检查
  - [ ] 提交订单
- [ ] cart store
  - [ ] 购物车状态管理
  - [ ] 本地持久化

#### 第5周: 订单模块
- [ ] 订单列表 (/orders)
  - [ ] 状态筛选
  - [ ] 订单卡片展示
- [ ] 订单详情 (/orders/:id)
  - [ ] OrderTimeline组件
  - [ ] 订单明细表格
  - [ ] 价格汇总
  - [ ] 操作按钮 (支付/取消/确认收货)
- [ ] orders store
- [ ] 账户管理 (/account)
  - [ ] CreditBadge组件
  - [ ] CreditProgress组件
  - [ ] 余额显示
  - [ ] 充值功能
  - [ ] 信用等级详情
  - [ ] 交易记录
- [ ] 收货地址管理 (/addresses)
  - [ ] 地址列表
  - [ ] CRUD操作

---

### 阶段三: 后台管理核心功能 (第6-8周)
**优先级: P1 (重要)**

#### 第6周: 图书管理
- [ ] 图书列表 (/admin/books)
  - [ ] 搜索与筛选
  - [ ] 批量操作
- [ ] 新增/编辑图书
  - [ ] AuthorSelector组件 (有序多选)
  - [ ] KeywordSelector组件 (最多10个)
  - [ ] CategoryTree组件
  - [ ] ImageUploader组件
  - [ ] 表单验证 (作者最多4个、关键字最多10个)
- [ ] 作者管理 (/admin/authors)
- [ ] 出版社管理 (/admin/publishers)

#### 第7周: 订单与库存管理
- [ ] 订单管理 (/admin/orders)
  - [ ] 订单列表与详情
  - [ ] 状态操作 (支付确认/发货/取消)
  - [ ] 发货表单 (物流公司/单号)
- [ ] 库存管理 (/admin/inventory)
  - [ ] InventoryStatus组件
  - [ ] 库存列表
  - [ ] 库存详情
  - [ ] 库存调整功能
  - [ ] 低库存预警

#### 第8周: 客户管理
- [ ] 客户列表 (/admin/customers)
  - [ ] 搜索与筛选
  - [ ] 信用等级筛选
- [ ] 客户详情 (/admin/customers/:id)
  - [ ] 基本信息
  - [ ] 信用等级管理
  - [ ] 账户操作 (充值/扣款)
  - [ ] 消费统计
  - [ ] 订单历史
  - [ ] 账户冻结/解冻

---

### 阶段四: 采购与缺书管理 (第9-10周)
**优先级: P2 (一般)**

#### 第9周: 供应商与缺书
- [ ] 供应商管理
  - [ ] 供应商列表与详情
  - [ ] CRUD操作
  - [ ] 供应图书管理
- [ ] 缺书登记 (前台 /out-of-stock)
  - [ ] 搜索图书
  - [ ] 登记缺书请求
  - [ ] 我的缺书列表
- [ ] 缺书管理 (后台 /admin/out-of-stock)
  - [ ] 记录列表
  - [ ] 筛选与排序
  - [ ] 状态更新

#### 第10周: 采购管理
- [ ] 采购单列表 (/admin/purchases)
- [ ] 新建采购单
  - [ ] 基于缺书记录推荐
  - [ ] 手工添加图书
  - [ ] 供应商报价对比
- [ ] 采购单详情
  - [ ] 审批流程
  - [ ] 收货登记
  - [ ] 关联缺书记录
- [ ] 到货通知功能

---

### 阶段五: 统计与优化 (第11-12周)
**优先级: P2 (一般)**

#### 第11周: 统计报表
- [ ] 仪表板完善 (/dashboard)
  - [ ] 销售趋势图 (Chart.js/ECharts)
  - [ ] 畅销图书排行
  - [ ] 实时指标卡片
- [ ] 销售统计 (/admin/stats/sales)
  - [ ] 时间维度统计
  - [ ] 图表展示
- [ ] 客户统计 (/admin/stats/customers)
  - [ ] 信用等级分布饼图
  - [ ] 新增用户趋势
- [ ] 库存统计 (/admin/stats/inventory)
  - [ ] 库存周转率
  - [ ] 滞销分析

#### 第12周: 性能优化与体验提升
- [ ] 性能优化
  - [ ] 图片懒加载
  - [ ] 虚拟滚动 (长列表)
  - [ ] 路由懒加载
  - [ ] 缓存策略 (keep-alive)
- [ ] 用户体验优化
  - [ ] 骨架屏
  - [ ] 加载状态统一管理
  - [ ] 错误提示优化
  - [ ] 表单防抖/节流
- [ ] 移动端适配
  - [ ] 响应式布局优化
  - [ ] 触摸手势支持

---

## 八、关键技术决策

### 8.1 数据流架构

```
┌─────────────┐
│ Vue组件     │
│             │
└──────┬──────┘
       │
       ▼
┌─────────────┐
│ Pinia Store │
│  (状态管理)  │
└──────┬──────┘
       │
       ▼
┌─────────────┐
│ API层       │
│  (Axios)    │
└──────┬──────┘
       │
       ▼
┌─────────────┐
│ 后端服务    │
│  (MySQL)    │
└─────────────┘
```

**单向数据流:**
1. 用户操作触发组件方法
2. 组件调用store的action
3. Action通过API与后端通信
4. 更新store状态
5. 组件响应式更新UI

### 8.2 本地缓存策略

| 数据类型 | 缓存位置 | 缓存时长 | 说明 |
|---------|---------|---------|------|
| 用户token | localStorage | 持久化 | 自动登录 |
| 用户信息 | localStorage | 持久化 | 快速加载 |
| 购物车 | localStorage | 持久化 | 跨设备同步需后端支持 |
| 图书列表 | 内存 (store) | 5分钟 | 减少API请求 |
| 分类/出版社 | 内存 | 30分钟 | 低频变更数据 |
| 搜索历史 | localStorage | 持久化 | 最多保存10条 |

**缓存失效策略:**
- 用户登出: 清除所有缓存
- token过期: 清除认证信息
- 数据更新: 立即清除相关缓存

### 8.3 权限控制

#### 路由级别
```typescript
// router/index.ts
{
  path: '/admin',
  meta: {
    requiresAuth: true,
    requiresAdmin: true
  }
}

// 路由守卫
router.beforeEach((to, from, next) => {
  const authStore = useAuthStore()

  if (to.meta.requiresAuth && !authStore.isAuthenticated) {
    return next('/auth/login')
  }

  if (to.meta.requiresAdmin && !authStore.isAdmin) {
    return next('/403')
  }

  next()
})
```

#### 组件级别
```vue
<template>
  <v-btn v-if="authStore.isAdmin">
    管理员操作
  </v-btn>

  <v-chip v-if="authStore.creditInfo.level >= 3">
    可透支
  </v-chip>
</template>
```

#### API级别
```typescript
// api/client.ts
apiClient.interceptors.request.use(config => {
  const token = localStorage.getItem('token')
  if (token) {
    config.headers.Authorization = `Bearer ${token}`
  }
  return config
})

// 后端验证token并返回401
apiClient.interceptors.response.use(
  response => response,
  error => {
    if (error.response?.status === 401) {
      // Token过期,跳转登录
      authStore.logout()
      router.push('/auth/login')
    }
    return Promise.reject(error)
  }
)
```

### 8.4 并发控制

#### 库存检查
**问题:** 多用户同时下单可能导致超卖

**解决方案:**
1. **前端预检查:** 加入购物车时检查可用库存
2. **后端行锁:** 调用 `sp_add_order_detail` 时使用 `SELECT ... FOR UPDATE`
3. **预留机制:** 下单时预留库存 (reserved_quantity)
4. **超时释放:** 未支付订单30分钟后自动取消并释放库存

```typescript
// 前端: 加入购物车
async addToCart(isbn: string, quantity: number) {
  // 1. 先检查库存
  const book = await bookApi.getBookDetail(isbn)
  if (book.inventory.available_quantity < quantity) {
    throw new Error('库存不足')
  }

  // 2. 添加到购物车 (后端会再次检查并预留)
  await cartApi.addItem(isbn, quantity)
}

// 后端: sp_add_order_detail
- SELECT (quantity - reserved_quantity) FOR UPDATE  // 行锁
- IF available < requested THEN SIGNAL '库存不足'
- UPDATE reserved_quantity = reserved_quantity + requested
- INSERT INTO order_details
- COMMIT
```

#### 信用折扣计算
**问题:** 订单创建到支付期间,用户信用等级可能变化

**解决方案:** 订单明细记录"下单时折扣率" (discount_rate)
```typescript
// 创建订单明细时记录瞬时折扣率
INSERT INTO order_details (
  discount_rate  // 记录下单时的折扣率,不受后续等级变化影响
)
```

### 8.5 用户体验优化

#### 加载状态
```typescript
// 全局加载: app store
appStore.setLoading(true)
try {
  await someAsyncOperation()
} finally {
  appStore.setLoading(false)
}

// 局部加载: 组件内
const loading = ref(false)
const loadData = async () => {
  loading.value = true
  try {
    // ...
  } finally {
    loading.value = false
  }
}
```

#### 错误提示
```typescript
// 统一错误处理
try {
  await orderApi.create(orderData)
  appStore.showNotification({
    type: 'success',
    message: '订单创建成功'
  })
} catch (error) {
  appStore.showNotification({
    type: 'error',
    message: error.message || '操作失败'
  })
}
```

#### 表单验证
```vue
<v-form ref="formRef" v-model="formValid">
  <v-text-field
    v-model="bookData.isbn"
    :rules="[
      v => !!v || 'ISBN不能为空',
      v => /^978-\d{10}$/.test(v) || 'ISBN格式错误'
    ]"
    label="ISBN"
  />
</v-form>
```

---

## 九、开发规范

### 9.1 命名规范

```typescript
// 组件: PascalCase
BookCard.vue
OrderSummary.vue

// 文件夹: kebab-case
order-management/
book-search/

// API字段: snake_case (与后端一致)
{
  customer_id: string
  account_balance: number
  credit_level: number
}

// 前端变量: snake_case
const order_status = 'pending'
const total_amount = 1000

// 类型/接口: PascalCase
interface Book {}
type OrderStatus = 'pending' | 'paid'

// 常量: UPPER_SNAKE_CASE
const API_BASE_URL = 'http://localhost:5000'
const MAX_AUTHORS = 4
```

### 9.2 代码风格

#### 使用Composition API
```typescript
// ✓ 推荐
<script setup lang="ts">
import { ref, computed, onMounted } from 'vue'

const count = ref(0)
const doubled = computed(() => count.value * 2)

onMounted(() => {
  console.log('mounted')
})
</script>

// ✗ 避免
export default {
  data() {
    return { count: 0 }
  },
  computed: {
    doubled() {
      return this.count * 2
    }
  }
}
```

#### TypeScript类型定义
```typescript
// src/types/book.ts
export interface Book {
  isbn: string
  title: string
  price: number
  publisher_id: string
  // ...
}

export interface BookDetail extends Book {
  authors: Author[]
  inventory: InventoryInfo
}

// 使用
import type { Book, BookDetail } from '@/types/book'
```

#### 组件Props和Emits
```typescript
<script setup lang="ts">
// Props定义
interface Props {
  modelValue: number
  max?: number
  disabled?: boolean
}

const props = withDefaults(defineProps<Props>(), {
  max: 100,
  disabled: false
})

// Emits定义
interface Emits {
  (e: 'update:modelValue', value: number): void
  (e: 'change', value: number): void
}

const emit = defineEmits<Emits>()
</script>
```

### 9.3 注释规范

#### 函数注释
```typescript
/**
 * 创建订单
 * @param orderData 订单数据
 * @returns 订单ID和订单号
 * @throws {Error} 余额不足或库存不足时抛出错误
 */
async function createOrder(orderData: CreateOrderRequest): Promise<CreateOrderResponse> {
  // ...
}
```

#### 复杂业务逻辑注释
```typescript
// 计算实际应付金额 (原价 - 折扣 + 运费)
const actualAmount = computed(() => {
  const original = cartStore.totalAmount
  const discount = original * authStore.creditInfo.discount_rate
  const shipping = calculateShippingFee(original)
  return original - discount + shipping
})
```

#### API接口注释
```typescript
// src/api/modules/books.ts

/**
 * 图书API
 */
export const bookApi = {
  /**
   * 获取图书列表
   * @param params 查询参数 (分页、搜索、筛选)
   * @returns 图书列表及分页信息
   */
  getBooks(params?: BookListParams): Promise<ApiResponse<BookListResponse>> {
    return apiClient.get('/books', { params })
  },

  /**
   * 获取图书详情
   * @param isbn 图书ISBN
   * @returns 图书详细信息 (含作者、库存等)
   */
  getBookDetail(isbn: string): Promise<ApiResponse<BookDetail>> {
    return apiClient.get(`/books/${isbn}`)
  }
}
```

### 9.4 文件组织

```
src/
├── api/                    # API接口
│   ├── client.ts          # Axios实例配置
│   └── modules/           # 分模块API
│       ├── auth.ts
│       ├── books.ts
│       ├── orders.ts
│       └── ...
├── assets/                # 静态资源
│   ├── images/
│   └── theme.css
├── components/            # 组件
│   ├── common/           # 通用组件
│   ├── business/         # 业务组件
│   └── layouts/          # 布局组件
├── router/               # 路由
│   └── index.ts
├── stores/               # Pinia状态管理
│   ├── auth.ts
│   ├── cart.ts
│   ├── books.ts
│   └── ...
├── types/                # TypeScript类型定义
│   ├── book.ts
│   ├── order.ts
│   ├── user.ts
│   └── api.ts
├── utils/                # 工具函数
│   ├── format.ts         # 格式化 (价格、日期等)
│   ├── validate.ts       # 验证规则
│   └── constants.ts      # 常量
├── views/                # 页面组件
│   ├── auth/            # 认证页面
│   ├── books/           # 图书相关
│   ├── orders/          # 订单相关
│   ├── admin/           # 后台管理
│   └── ...
├── App.vue
└── main.ts
```

---

## 十、测试策略

### 10.1 单元测试 (Vitest)

```typescript
// 测试store
import { setActivePinia, createPinia } from 'pinia'
import { useCartStore } from '@/stores/cart'

describe('Cart Store', () => {
  beforeEach(() => {
    setActivePinia(createPinia())
  })

  it('adds item to cart', async () => {
    const cartStore = useCartStore()
    await cartStore.addItem('978-1234567890', 2)
    expect(cartStore.totalItems).toBe(2)
  })

  it('calculates total amount correctly', () => {
    const cartStore = useCartStore()
    // ...
  })
})
```

### 10.2 集成测试

```typescript
// 测试完整购物流程
describe('Purchase Flow', () => {
  it('completes a purchase', async () => {
    // 1. 搜索图书
    // 2. 加入购物车
    // 3. 结算
    // 4. 创建订单
    // 5. 支付
    // 验证订单状态
  })
})
```

### 10.3 E2E测试 (Playwright/Cypress)

```typescript
// e2e/purchase.spec.ts
test('用户购书流程', async ({ page }) => {
  // 登录
  await page.goto('/auth/login')
  await page.fill('input[name="username"]', 'testuser')
  await page.fill('input[name="password"]', 'password')
  await page.click('button[type="submit"]')

  // 搜索图书
  await page.goto('/books')
  await page.fill('input[placeholder="搜索"]', 'Vue.js')
  await page.press('input', 'Enter')

  // 加入购物车
  await page.click('.book-card:first-child .add-to-cart')

  // 结算
  await page.click('.cart-icon')
  await page.click('.checkout-btn')

  // 验证订单创建成功
  await expect(page.locator('.order-success')).toBeVisible()
})
```

---

## 十一、部署与运维

### 11.1 构建配置

```bash
# 开发环境
npm run dev

# 生产构建
npm run build

# 预览构建结果
npm run preview
```

### 11.2 环境变量

```bash
# .env.development
VITE_API_BASE_URL=http://localhost:5000
VITE_APP_TITLE=EasyBook (Dev)

# .env.production
VITE_API_BASE_URL=https://api.easybook.com
VITE_APP_TITLE=EasyBook
```

### 11.3 性能优化

```typescript
// vite.config.ts
export default defineConfig({
  build: {
    rollupOptions: {
      output: {
        manualChunks: {
          'vendor': ['vue', 'vue-router', 'pinia'],
          'vuetify': ['vuetify'],
          'charts': ['chart.js']
        }
      }
    },
    chunkSizeWarningLimit: 1000
  }
})
```

---

## 十二、附录

### 12.1 技术文档链接

- [Vue 3 官方文档](https://vuejs.org/)
- [Vuetify 3 文档](https://vuetifyjs.com/)
- [Pinia 文档](https://pinia.vuejs.org/)
- [TypeScript 手册](https://www.typescriptlang.org/docs/)
- [Vite 文档](https://vitejs.dev/)

### 12.2 数据库相关

- 数据库设计文档: `数据库设计文档.md`
- E-R图: `数据库设计文档/image/`
- SQL脚本: (待后端提供)

### 12.3 项目信息

```json
{
  "name": "EasyBook",
  "description": "网上书店管理系统前端",
  "version": "1.0.0",
  "authors": ["加鹿鸣", "肖弘基"],
  "class": "软件2305班",
  "studentIds": ["U202317327", "U202317334"]
}
```

---

**文档版本:** v1.0
**最后更新:** 2025-01
**维护者:** Claude Code
